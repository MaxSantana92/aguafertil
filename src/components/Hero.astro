---
import { Image } from 'astro:assets';
import hero1 from '../assets/hero/hero_1.webp';
import hero2 from '../assets/hero/hero_2.webp';
import hero3 from '../assets/hero/hero_3.webp';
import hero4 from '../assets/hero/hero_4.webp';
import { getLangFromUrl, useTranslations, useTranslatedPath } from '../i18n/utils';
import Button from './Button.astro';

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
const translatePath = useTranslatedPath(lang);

const slidesData = [
  {
    src: hero1,
    alt: t('hero.slide1.alt') || "Campo de cultivo agrícola"
  },
  {
    src: hero2,
    alt: t('hero.slide2.alt') || "Sistema de riego eficiente"
  },
  {
    src: hero3,
    alt: t('hero.slide3.alt') || "Tecnología agrícola avanzada"
  },
  {
    src: hero4,
    alt: t('hero.slide4.alt') || "Sostenibilidad y medio ambiente"
  }
];
---

<section id="inicio" class="relative h-screen w-full">
  <div class="absolute inset-0 overflow-hidden">
    <div class="slider-container relative w-full h-full">
      {slidesData.map((slide, index) => (
        <div class={`slide ${index === 0 ? 'active' : ''}`}>
          <div class="absolute inset-0 bg-black/30 z-10"></div>
          <Image 
            src={slide.src} 
            alt={slide.alt}
            width={1920}
            height={1080}
            widths={[640, 1024, 1920]}
            sizes="100vw"
            loading={index === 0 ? "eager" : "lazy"}
            fetchpriority={index === 0 ? "high" : "low"}
            class="w-full h-full object-cover"
          />
        </div>
      ))}
    </div>
  </div>

  <div class="relative z-10 h-full flex items-center">
    <div class="container mx-auto px-4">
      <div class="max-w-3xl">

        <h1 class="text-5xl md:text-7xl font-bold text-white mb-6 leading-tight animate-slide-up">
          {t('hero.title')}
        </h1>

        <p class="text-xl md:text-2xl text-white/90 mb-8 leading-relaxed animate-slide-up" style="animation-delay: 0.2s;">
          {t('hero.subtitle')}
        </p>

        <div class="flex flex-col sm:flex-row gap-4 animate-slide-up" style="animation-delay: 0.4s;">
          <Button 
            href={translatePath('#contacto')} 
            text={t('hero.cta')} 
            className="text-lg px-10 py-4"
          >
            <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
            </svg>
          </Button>
          <a href={translatePath('#tecnologias')} class="bg-white/10 backdrop-blur-md text-white border-2 border-white/50 px-8 py-4 rounded-full font-semibold hover:bg-white/20 transition-all inline-flex items-center justify-center">
            {t('hero.cta.secondary')}
          </a>
        </div>
      </div>
    </div>
  </div>

  <button id="prev-slide" class="absolute left-4 top-1/2 -translate-y-1/2 z-20 w-12 h-12 bg-white/20 backdrop-blur-md rounded-full flex items-center justify-center text-white hover:bg-white/30 transition-all">
    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
    </svg>
  </button>

  <button id="next-slide" class="absolute right-4 top-1/2 -translate-y-1/2 z-20 w-12 h-12 bg-white/20 backdrop-blur-md rounded-full flex items-center justify-center text-white hover:bg-white/30 transition-all">
    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
    </svg>
  </button>

  <div class="absolute bottom-8 left-1/2 -translate-x-1/2 z-20 flex space-x-2">
    <button class="slider-dot active w-3 h-3 rounded-full bg-white transition-all" data-slide="0"></button>
    <button class="slider-dot w-3 h-3 rounded-full bg-white/50 transition-all" data-slide="1"></button>
    <button class="slider-dot w-3 h-3 rounded-full bg-white/50 transition-all" data-slide="2"></button>
    <button class="slider-dot w-3 h-3 rounded-full bg-white/50 transition-all" data-slide="3"></button>
  </div>
</section>

<style>
  .slide {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    opacity: 0;
    transition: opacity 1s ease-in-out;
  }

  .slide.active {
    opacity: 1;
  }

  .slider-dot.active {
    width: 2rem;
    background: white;
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }

  @keyframes slideUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .animate-fade-in {
    animation: fadeIn 1s ease-out;
  }

  .animate-slide-up {
    animation: slideUp 1s ease-out;
    animation-fill-mode: both;
  }
</style>

<script>
  let currentSlide = 0;
  const slides = document.querySelectorAll('.slide');
  const dots = document.querySelectorAll('.slider-dot');
  const totalSlides = slides.length;

  function showSlide(n: number) {
    slides.forEach((slide) => slide.classList.remove('active'));
    dots.forEach((dot) => dot.classList.remove('active'));

    currentSlide = (n + totalSlides) % totalSlides;
    slides[currentSlide].classList.add('active');
    dots[currentSlide].classList.add('active');
  }

  function nextSlide() {
    showSlide(currentSlide + 1);
  }

  function prevSlide() {
    showSlide(currentSlide - 1);
  }

  document.getElementById('next-slide')?.addEventListener('click', nextSlide);
  document.getElementById('prev-slide')?.addEventListener('click', prevSlide);

  dots.forEach((dot, index) => {
    dot.addEventListener('click', () => showSlide(index));
  });

  setInterval(nextSlide, 5000);
</script>
