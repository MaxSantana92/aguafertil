---
import { getLangFromUrl, useTranslations, useTranslatedPath } from '../i18n/utils';
import Button from './Button.astro';

import { Image } from 'astro:assets';
import isoLogo from '../assets/iso_logo.png';

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
const translatePath = useTranslatedPath(lang);
---

<nav class="fixed top-0 left-0 right-0 z-50 bg-white/60 backdrop-blur-md border-b border-white/20 shadow-lg transition-all duration-300" id="navbar">
  <div class="container mx-auto px-4 py-4">
    <div class="flex items-center justify-between">
      <a href={translatePath('/')} class="flex items-center space-x-2">
        <Image 
          src={isoLogo} 
          alt="Agua Fertil Logo" 
          width={48} 
          height={48} 
          class="w-12 h-12 object-contain"
          loading="eager"
        />
        <div class="text-center">
          <span class="nav-brand-title block text-2xl font-bold text-[#40B6D9]"><span class="nav-brand-agua">agua</span><span class="nav-brand-highlight text-[#8DC63F]">f√©rtil</span></span>
          <p class="nav-brand-subtitle text-[10px] text-[#8DC63F] font-bold uppercase tracking-widest leading-none text-gray-900 font-medium">{t('nav.slogan')}</p>
        </div>
      </a>

      <button class="lg:hidden text-gray-700" id="mobile-menu-button" aria-label="Menu">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
      </button>

      <div class="hidden lg:flex items-center space-x-8">
        <a href={translatePath('#inicio')} class="nav-link text-gray-700 hover:text-emerald-600 transition-colors font-medium">{t('nav.inicio')}</a>
        <a href={translatePath('#quienes-somos')} class="nav-link text-gray-700 hover:text-emerald-600 transition-colors font-medium">{t('nav.quienes')}</a>
        <a href={translatePath('#tecnologias')} class="nav-link text-gray-700 hover:text-emerald-600 transition-colors font-medium">{t('nav.productos')}</a>
        <a href={translatePath('#beneficios')} class="nav-link text-gray-700 hover:text-emerald-600 transition-colors font-medium">{t('nav.beneficios')}</a>
        <a href={translatePath('#testimonios')} class="nav-link text-gray-700 hover:text-emerald-600 transition-colors font-medium">{t('nav.testimonios')}</a>
        
        <div class="flex items-center gap-3">

          <Button 
            href={translatePath('#contacto')} 
            text={t('nav.contacto')} 
            className="px-6 py-2.5"
          />
        </div>

        <div class="flex items-center space-x-2 border-l pl-6">
          <a href={translatePath('/', 'es')} class={`px-3 py-2 rounded ${lang === 'es' ? 'bg-emerald-100 text-emerald-700 font-semibold' : 'text-gray-600 hover:text-emerald-600'}`}>ES</a>
          <a href={translatePath('/', 'en')} class={`px-3 py-2 rounded ${lang === 'en' ? 'bg-emerald-100 text-emerald-700 font-semibold' : 'text-gray-600 hover:text-emerald-600'}`}>EN</a>
        </div>
      </div>
    </div>

    <div class="hidden lg:hidden mt-4 pb-4 space-y-3" id="mobile-menu">
      <a href={translatePath('#inicio')} class="nav-link block text-gray-700 hover:text-emerald-600 transition-colors font-medium">{t('nav.inicio')}</a>
      <a href={translatePath('#quienes-somos')} class="nav-link block text-gray-700 hover:text-emerald-600 transition-colors font-medium">{t('nav.quienes')}</a>
      <a href={translatePath('#tecnologias')} class="nav-link block text-gray-700 hover:text-emerald-600 transition-colors font-medium">{t('nav.productos')}</a>
      <a href={translatePath('#beneficios')} class="nav-link block text-gray-700 hover:text-emerald-600 transition-colors font-medium">{t('nav.beneficios')}</a>
      <a href={translatePath('#testimonios')} class="nav-link block text-gray-700 hover:text-emerald-600 transition-colors font-medium">{t('nav.testimonios')}</a>
      
      <div class="flex items-center gap-3 pt-2">

        <Button 
          href={translatePath('#contacto')} 
          text={t('nav.contacto')} 
          className="flex-1"
        />
      </div>
      
      <div class="flex items-center space-x-2 pt-2">
        <a href={translatePath('/', 'es')} class={`px-4 py-3 rounded ${lang === 'es' ? 'bg-emerald-100 text-emerald-700 font-semibold' : 'text-gray-600'}`}>ES</a>
        <a href={translatePath('/', 'en')} class={`px-4 py-3 rounded ${lang === 'en' ? 'bg-emerald-100 text-emerald-700 font-semibold' : 'text-gray-600'}`}>EN</a>
      </div>
    </div>
  </div>
</nav>

<script>
  const mobileMenuButton = document.getElementById('mobile-menu-button');
  const mobileMenu = document.getElementById('mobile-menu');

  mobileMenuButton?.addEventListener('click', () => {
    mobileMenu?.classList.toggle('hidden');
  });

  const navbar = document.getElementById('navbar');
  const heroSection = document.getElementById('inicio');

  if (heroSection && navbar) {
    const heroObserver = new IntersectionObserver(
      (entries) => {
        const isHeroVisible = entries[0]?.isIntersecting;
        navbar.classList.toggle('nav-on-hero', Boolean(isHeroVisible));
      },
      { threshold: 0.6 }
    );
    heroObserver.observe(heroSection);
  }

  window.addEventListener('scroll', () => {
    if (window.scrollY > 50) {
      navbar?.classList.add('shadow-xl');
      navbar?.classList.remove('shadow-lg');
    } else {
      navbar?.classList.add('shadow-lg');
      navbar?.classList.remove('shadow-xl');
    }
  });
</script>

<style>
  #navbar.nav-on-hero {
    background: rgba(15, 23, 42, 0.55);
    border-color: transparent;
  }

  #navbar.nav-on-hero .nav-link {
    color: #ffffff;
  }

  #navbar.nav-on-hero .nav-link:hover {
    color: #d1fae5;
  }

  #navbar.nav-on-hero .nav-brand-title {
    color: var(--theme-primary);
  }

  #navbar.nav-on-hero .nav-brand-agua {
    color: #ffffff;
  }

  #navbar.nav-on-hero .nav-brand-highlight {
    color: var(--theme-primary);
  }

  #navbar.nav-on-hero .nav-brand-subtitle {
    color: var(--theme-primary-light, #5dc4e0);
  }

  #navbar.nav-on-hero #mobile-menu-button {
    color: #ffffff;
  }
</style>
